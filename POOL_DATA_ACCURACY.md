# –¢–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø—É–ª–æ–≤ - –∫–∞–∫ –º—ã —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É

## –ü—Ä–æ–±–ª–µ–º–∞: TVL $76M –≤–º–µ—Å—Ç–æ $52.9M (Uniswap –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç $52.9M)

### –ü–æ—á–µ–º—É –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–ª–∏?

**The Graph Subgraph –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ!**

1. **pool.totalValueLockedUSD** - —ç—Ç–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–µ —Å—Ä–∞–∑—É
2. **poolHourData[0].tvlUSD** - —Ç–æ–∂–µ –º–æ–∂–µ—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏
3. The Graph indexer –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–ª–æ–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (–∏–Ω–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –∏–ª–∏ –¥–∞–∂–µ —á–∞—Å–æ–≤)

**Uniswap UI –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ The Graph –¥–ª—è TVL!**
- –û–Ω–∏ –ø–æ–ª—É—á–∞—é—Ç —Ç–µ–∫—É—â–∏–µ –±–∞–ª–∞–Ω—Å—ã —Ç–æ–∫–µ–Ω–æ–≤ **–Ω–∞–ø—Ä—è–º—É—é –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞ —á–µ—Ä–µ–∑ RPC**
- `token0.balanceOf(poolAddress)` + `token1.balanceOf(poolAddress)`
- –£–º–Ω–æ–∂–∞—é—Ç –Ω–∞ —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí –ø–æ–ª—É—á–∞—é—Ç real-time TVL

## –†–µ—à–µ–Ω–∏–µ: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–∫–∞–∫ Uniswap)

### üìä –û—Ç–∫—É–¥–∞ –±–µ—Ä–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –ü–æ—á–µ–º—É |
|---------|----------|--------|
| **24h Volume** | The Graph `poolHourData` (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞) | –°—É–º–º–∏—Ä—É–µ–º hourly data –∑–∞ 24 —á–∞—Å–∞ |
| **24h Fees** | The Graph `poolHourData` (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞) | –°—É–º–º–∏—Ä—É–µ–º hourly data –∑–∞ 24 —á–∞—Å–∞ |
| **TVL** | **Blockchain RPC** (real-time) | –ë–∞–ª–∞–Ω—Å—ã —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ |
| **APR** | –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º: `(fees24h / tvl) * 365 * 100` | –ù–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |

### üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

#### 1. Volume –∏ Fees –∏–∑ The Graph (—Ç–æ—á–Ω–æ –∫–∞–∫ Uniswap)
```typescript
// –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞ hourly data
poolHourData(first: 24, orderBy: periodStartUnix, orderDirection: desc) {
  volumeUSD
  feesUSD
}

// –°—É–º–º–∏—Ä—É–µ–º –≤—Å–µ 24 —á–∞—Å–∞
const volume24h = last24Hours.reduce((sum, hour) => sum + hour.volumeUSD, 0)
const fees24h = last24Hours.reduce((sum, hour) => sum + hour.feesUSD, 0)
```

#### 2. TVL –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞ (REAL-TIME!)
```typescript
// –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å—ã —Ç–æ–∫–µ–Ω–æ–≤ –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò
const token0Balance = await token0Contract.balanceOf(poolAddress)
const token1Balance = await token1Contract.balanceOf(poolAddress)

// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã –∏–∑ CoinGecko
const prices = await getTokenPrices(token0Symbol, token1Symbol)

// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º TVL
const tvl = (token0Balance * token0Price) + (token1Balance * token1Price)
```

### üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

‚úÖ **TVL –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π** - –ø—Ä—è–º–æ –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞
‚úÖ **–ù–µ –∑–∞–≤–∏—Å–∏–º –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ The Graph**
‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ The Graph –æ—Ç—Å—Ç–∞–µ—Ç**
‚úÖ **–¢–æ—á–Ω–æ –∫–∞–∫ Uniswap UI** - —Ç–µ –∂–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
‚úÖ **Fallback –Ω–∞ subgraph** –µ—Å–ª–∏ RPC –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### üìù –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ RPC (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ!)
```typescript
// lib/uniswap/pool-contract.ts
const RPC_URLS = {
  arbitrum: 'https://arb1.arbitrum.io/rpc',  // –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π RPC
  mainnet: 'https://eth.llamarpc.com',
  polygon: 'https://polygon-rpc.com',
  // ...
}
```

**–ù–∏—á–µ–≥–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ** - –∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ RPC!

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Alchemy/Infura (–±—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ)
1. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –æ—Ç [Alchemy](https://dashboard.alchemy.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ `.env.local`:
```bash
NEXT_PUBLIC_ALCHEMY_ID="your_alchemy_api_key"
NEXT_PUBLIC_GRAPH_API_KEY="your_graph_api_key"  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

3. –û–±–Ω–æ–≤–∏—Ç–µ RPC URLs –≤ `lib/uniswap/pool-contract.ts`:
```typescript
const RPC_URLS = {
  arbitrum: `https://arb-mainnet.g.alchemy.com/v2/${process.env.NEXT_PUBLIC_ALCHEMY_ID}`,
  // ...
}
```

### üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø—É–ª WBTC/ETH –Ω–∞ Arbitrum:**
```bash
curl -X POST http://localhost:3000/api/admin/pools/import \
  -H "Content-Type: application/json" \
  -d '{
    "action": "import-single",
    "poolAddress": "0x2f5e87c9312fa29aed5c179e456625d79015299c",
    "network": "arbitrum"
  }'
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** - –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
üîó Fetching REAL TVL from blockchain via RPC...
‚úÖ REAL TVL from blockchain: $52,900,000 (136.63 WBTC + 14,600 ETH)
üìä FINAL METRICS:
  volume24h: 43,100,000
  fees24h: 21,600
  tvl: 52,900,000
  apr: 14.88%
  dataSources:
    volume: poolHourData (last 24 hours)
    fees: poolHourData (last 24 hours)
    tvl: Blockchain RPC (REAL-TIME)
```

3. **–°—Ä–∞–≤–Ω–∏—Ç–µ —Å Uniswap:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ https://app.uniswap.org/explore/pools/arbitrum/0x2f5e87c9312fa29aed5c179e456625d79015299c
   - –ó–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å!

### üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—É–ª–æ–≤ –∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç, –¥–æ–±–∞–≤—å—Ç–µ cron job –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Next.js API route —Å setInterval:

```typescript
// app/api/cron/update-pools/route.ts
export async function GET() {
  const pools = await prisma.pool.findMany({ where: { isActive: true } })

  for (const pool of pools) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –ø—É–ª–∞
    await updatePoolData(pool.address, pool.network)
  }

  return NextResponse.json({ success: true, updated: pools.length })
}
```

–ó–∞–ø—É—Å–∫–∞–π—Ç–µ –∫–∞–∂–¥—ã–µ 5-10 –º–∏–Ω—É—Ç —á–µ—Ä–µ–∑ cron –∏–ª–∏ Vercel Cron Jobs.

### üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:

- [Uniswap V3 Subgraph Docs](https://docs.uniswap.org/api/subgraph/overview)
- [CoinGecko Price API](https://www.coingecko.com/en/api/documentation)
- [Ethers.js Documentation](https://docs.ethers.org/)

---

**–ò—Ç–æ–≥:** –¢–µ–ø–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å Uniswap UI! üéâ
